<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>èŠ±å¤©Judy ï½œQuick Travel Guide</title>
    <style>
        :root {
            /* é…è‰²ï¼šæ—¥å¼æ¥µç°¡ x æ²™æ¼ é¢¨æƒ… */
            --bg-color: #F8F8F6; /* ç”Ÿæˆè‰² */
            --card-bg: #FFFFFF;
            --text-main: #3E3E3E; /* å¢¨ç° */
            --text-light: #949494;
            --accent-sand: #C5A065; /* æ²™æ¼ é‡‘ */
            --accent-pink: #D89F9F; /* èŠ±å¤©ç²‰ */
            --accent-blue: #7EA6B8; /* ç´¢ç§‘ç‰¹æ‹‰è— */
            --border-radius: 14px;
            --shadow: 0 4px 16px rgba(0,0,0,0.04);
            --nav-height: 80px;
            --font-stack: -apple-system, BlinkMacSystemFont, "PingFang TC", "Microsoft JhengHei", sans-serif;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font-stack);
            margin: 0;
            padding: 0;
            padding-bottom: var(--nav-height);
            line-height: 1.6;
        }

        /* HEADER */
        header {
            padding: 40px 24px 15px 24px;
            background: rgba(248, 248, 246, 0.95);
            position: sticky;
            top: 0;
            z-index: 50;
            backdrop-filter: blur(8px);
            border-bottom: 1px solid rgba(0,0,0,0.03);
        }
        h1 { margin: 0; font-size: 20px; font-weight: 700; letter-spacing: 1px; color: var(--text-main); }
        .subtitle { font-size: 11px; color: var(--accent-sand); letter-spacing: 2px; text-transform: uppercase; margin-top: 4px; display: block; font-weight: 600; }

        /* SECTIONS */
        .section { display: none; padding: 15px 20px; animation: fadeIn 0.3s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* TIMELINE CARDS */
        .date-header {
            margin: 30px 0 12px 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .date-title { font-size: 17px; font-weight: 700; color: var(--text-main); }
        .weather-badge {
            font-size: 12px; color: var(--text-light);
            background: #EAEAEA; padding: 2px 10px; border-radius: 20px;
            display: flex; align-items: center; gap: 4px;
        }

        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 16px;
            margin-bottom: 14px;
            box-shadow: var(--shadow);
            position: relative;
            border-left: 3px solid #DDD;
            transition: transform 0.1s;
        }
        .card:active { transform: scale(0.98); }

        /* Card Colors by Type */
        .card.transport { border-left-color: #A0A0A0; } /* äº¤é€š: ç° */
        .card.stay { border-left-color: var(--accent-sand); } /* ä½å®¿: é‡‘ */
        .card.food { border-left-color: var(--accent-pink); } /* é£Ÿç‰©: ç²‰ */
        .card.activity { border-left-color: var(--accent-blue); } /* æ™¯é»: è— */

        .card-time { font-size: 12px; color: var(--accent-sand); font-weight: 700; font-family: monospace; display: block; margin-bottom: 6px; text-transform: uppercase; }
        .card-title { font-size: 16px; font-weight: 700; margin-bottom: 8px; line-height: 1.4; }
        .card-desc { font-size: 14px; color: #666; margin-bottom: 10px; white-space: pre-line; text-align: justify; }

        /* MAP BUTTON */
        .btn-map {
            display: inline-flex;
            align-items: center;
            background: #F2F2F2;
            color: var(--text-main);
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            text-decoration: none;
            margin-top: 4px;
        }
        .btn-map::before { content: 'ğŸ“'; margin-right: 4px; font-size: 10px; }

        /* SMART HIGHLIGHTS */
        .hl-basic { background: #FFF4E5; color: #D35400; padding: 0 4px; border-radius: 4px; font-weight: 500; } /* Orange - Important */
        .hl-photo { background: #E8F4F8; color: #2980B9; padding: 0 4px; border-radius: 4px; font-weight: 500; } /* Blue - Photo/Nature */
        .hl-alert { background: #FDEBD0; color: #C0392B; padding: 0 4px; border-radius: 4px; font-weight: bold; } /* Red - Warning */

        /* INFO & FLIGHTS */
        .info-block { margin-bottom: 30px; }
        .info-header { font-size: 13px; font-weight: 700; color: var(--text-light); margin-bottom: 10px; letter-spacing: 1px; border-left: 3px solid var(--accent-sand); padding-left: 8px; }
        
        .flight-row {
            display: grid;
            grid-template-columns: 0.6fr 1.8fr 0.8fr;
            padding: 12px 0;
            border-bottom: 1px solid #F0F0F0;
            font-size: 14px;
            align-items: center;
        }
        .flight-row:last-child { border-bottom: none; }
        .f-date { font-weight: 700; color: var(--accent-blue); font-size: 12px; }
        .f-route { font-weight: 600; color: var(--text-main); }
        .f-detail { font-size: 11px; color: #888; display: block; margin-top: 2px; }
        .f-time { text-align: right; font-family: monospace; font-size: 13px; font-weight: 600; }

        /* CHECKLIST */
        .check-group { margin-bottom: 25px; }
        .check-category { font-size: 14px; font-weight: 700; color: var(--accent-sand); margin-bottom: 10px; }
        .check-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #F4F4F4;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .checkbox {
            width: 20px; height: 20px;
            border: 1.5px solid #CCC;
            border-radius: 50%;
            margin-right: 12px;
            display: flex; align-items: center; justify-content: center;
            flex-shrink: 0;
        }
        .check-item.checked .checkbox { background: var(--accent-pink); border-color: var(--accent-pink); }
        .check-item.checked .checkbox::after { content: 'âœ“'; color: white; font-size: 12px; }
        .check-item.checked span { color: #CCC; text-decoration: line-through; }

        /* BOTTOM NAV */
        .bottom-nav {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            background: rgba(255, 255, 255, 0.96);
            border-top: 1px solid #EEE;
            display: flex;
            justify-content: space-around;
            padding: 10px 0 25px 0; /* Extra safe area for iOS */
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        .nav-item {
            text-align: center;
            font-size: 10px;
            color: #C0C0C0;
            flex: 1;
            cursor: pointer;
            transition: color 0.3s;
        }
        .nav-item.active { color: var(--text-main); font-weight: 600; }
        .nav-icon { font-size: 22px; display: block; margin-bottom: 4px; }

    </style>
</head>
<body>

    <header>
        <h1>èŠ±å¤©Judy</h1>
        <span class="subtitle">Quick Travel Guide</span>
    </header>

    <div id="tab-timeline" class="section active">
        <div id="timeline-container"></div>
    </div>

    <div id="tab-info" class="section">
        
        <div class="info-block">
            <div class="info-header">FLIGHTS èˆªç­è³‡è¨Š</div>
            <div class="card">
                <div id="flights-list"></div>
            </div>
        </div>

        <div class="info-block">
            <div class="info-header">HOTELS ä½å®¿è³‡è¨Š</div>
            <div id="hotels-list"></div>
        </div>

        <div class="info-block">
            <div class="info-header">MAP åœ°åœ–</div>
            <div class="card">
                <div class="card-title">æ™¯é»åœ°åœ–</div>
                <div class="card-desc">é»æ“Šä¸‹æ–¹æŒ‰éˆ•é–‹å•Ÿä¸»è¦æ™¯é»å°èˆª</div>
                <a href="https://www.google.com/maps/search/?api=1&query=Socotra+Island" target="_blank" class="btn-map" style="width:100%; justify-content:center;">é–‹å•Ÿ Google Maps</a>
            </div>
        </div>

    </div>

    <div id="tab-checklist" class="section">
        <div id="checklist-container"></div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('timeline', this)">
            <span class="nav-icon">ğŸ“…</span>è¡Œç¨‹
        </div>
        <div class="nav-item" onclick="switchTab('info', this)">
            <span class="nav-icon">ğŸ«</span>è³‡è¨Š
        </div>
        <div class="nav-item" onclick="switchTab('checklist', this)">
            <span class="nav-icon">ğŸ’</span>æ‰“åŒ…
        </div>
    </nav>

    <script>
        // --- DATA ---

        const flights = [
            {date: "2/15", code: "EK367", route: "TPE å°åŒ— â†’ DXB æœæ‹œ", time: "23:00 - 04:50", term: "T3"},
            {date: "2/16", code: "XY502", route: "DXB æœæ‹œ â†’ JED å‰é”", time: "12:20 - 14:45", term: "T1"},
            {date: "2/17", code: "IY525", route: "JED å‰é” â†’ SCT ç´¢ç§‘ç‰¹æ‹‰", time: "11:00 - 14:30", term: "-"},
            {date: "2/23", code: "IY526", route: "SCT ç´¢ç§‘ç‰¹æ‹‰ â†’ JED å‰é”", time: "10:30 - 14:00", term: "-"},
            {date: "2/23", code: "XY505", route: "JED å‰é” â†’ DXB æœæ‹œ", time: "17:00 - 20:45", term: "-"},
            {date: "2/26", code: "EK386", route: "DXB æœæ‹œ â†’ TPE å°åŒ—", time: "08:45 - 20:40", term: "T3"}
        ];

        const hotels = [
            {name: "Best Western Plus Jeddah", addr: "Madinah Road, Jeddah", desc: "è¿‘æ¿±æµ·è·¯ / å‰é”"},
            {name: "Socotra Campsites", addr: "Socotra Island", desc: "ç§äººå¸³ç¯· (Erisel / Fermhin / Detwah)"},
            {name: "Grande Signature Apartments", addr: "Downtown Dubai", desc: "æœæ‹œå¸‚ä¸­å¿ƒ"}
        ];

        const itinerary = [
            {
                date: "2/15 (æ—¥)", loc: "Taipei", lat: 25.07, lon: 121.23,
                items: [
                    {time: "23:00", title: "EK367 èµ·é£›", type: "transport", desc: "å‰å¾€æœæ‹œ | é£›è¡Œæ™‚é–“ç´„ 9hr 50m", nav: "Taoyuan Airport"}
                ]
            },
            {
                date: "2/16 (ä¸€)", loc: "Jeddah", lat: 21.54, lon: 39.17,
                items: [
                    {time: "04:50", title: "æŠµé”æœæ‹œ (è½‰æ©Ÿ)", type: "transport", desc: "ç­‰å¾…è½‰æ©Ÿå‰å¾€å‰é”"},
                    {time: "12:20", title: "é£›å¾€å‰é”", type: "transport", desc: "XY502 | æŠµé”å¾Œå…¥å¢ƒæ²™çƒåœ°"},
                    {time: "16:00", title: "Check-in é£¯åº—", type: "stay", desc: "Best Western Plus Jeddah Hotel", nav: "Best Western Plus Jeddah Hotel Madinah Road"},
                    {time: "Night", title: "Waterfront Dinner", type: "food", desc: "å‰é”æ¿±æµ·è·¯æ•£æ­¥èˆ‡æ™šé¤", nav: "Jeddah Corniche"}
                ]
            },
            {
                date: "2/17 (äºŒ)", loc: "Socotra", lat: 12.6, lon: 54.0,
                items: [
                    {time: "11:00", title: "é£›å¾€ç´¢ç§‘ç‰¹æ‹‰", type: "transport", desc: "IY525 (JED -> SCT)"},
                    {time: "14:30", title: "Majestic White Dunes", type: "activity", desc: "æŠµé”ï¼å‰å¾€æ±éƒ¨ã€‚é€”ç¶“é¦–éƒ½ Hadiboï¼Œé çœº Hajhair å±±è„ˆã€‚"},
                    {time: "Night", title: "Erisel Beach éœ²ç‡Ÿ", type: "stay", desc: "ç¬¬ä¸€æ™šæµ·ç˜ç§äººå¸³ç¯·ï¼Œäº«å—æ˜Ÿç©ºã€‚", nav: "Arher Beach"}
                ]
            },
            {
                date: "2/18 (ä¸‰)", loc: "Socotra", lat: 12.6, lon: 54.0,
                items: [
                    {time: "Sunrise", title: "Arher Sand Dunes", type: "activity", desc: "å¿…çœ‹æ—¥å‡ºï¼çˆ¬ä¸Šå·¨å¤§æ²™ä¸˜ã€æ»‘æ²™ã€‚æ—©é¤æ™‚ç•™æ„æµ·è±š (Spinner Dolphins)ã€‚", nav: "Arher Beach"},
                    {time: "AM", title: "Dihamri æµ·æ´‹ä¿è­·å€", type: "activity", desc: "æµ®æ½›ç†±é» (Snorkeling)ï¼Œè±å¯ŒçŠç‘šèˆ‡é­šç¾¤ã€‚äº«ç”¨åˆé¤ã€‚", nav: "Dihamri Marine Protected Area"},
                    {time: "PM", title: "Homhil ç„¡é‚Šéš›æ³³æ± ", type: "activity", desc: "çµ•ç¾å¤©ç„¶æ³³æ±  (Infinity Pool)ï¼Œçœºæœ›åŒ—å²¸ã€‚æ²¿é€”å¯è¦‹ç“¶å­æ¨¹èˆ‡é¾è¡€æ¨¹ã€‚", nav: "Homhil Protected Area"},
                    {time: "Night", title: "Erisel Beach éœ²ç‡Ÿ", type: "stay", desc: "è¿”å›æ±å²¸ç‡Ÿåœ°éå¤œã€‚"}
                ]
            },
            {
                date: "2/19 (å››)", loc: "Socotra", lat: 12.5, lon: 53.9,
                items: [
                    {time: "AM", title: "Kaleesan White Canyon", type: "activity", desc: "ç™½è‰²å³½è°·èˆ‡è”šè—æ± æ°´ï¼Œé©åˆæ¸¸æ³³è·³æ°´ã€‚", nav: "Wadi Kalisan"},
                    {time: "PM", title: "Zahek Desert & Camel", type: "activity", desc: "æ²™æ¼ æ¼«æ­¥èˆ‡é¨é§±é§ï¼Œé«”é©—é˜¿æ‹‰ä¼¯ä¹‹å¤œæ°›åœã€‚", nav: "Zahek Dunes"},
                    {time: "Stop", title: "Digub Cave", type: "activity", desc: "å·¨å¤§æ´ç©´ï¼Œä¿¯ç°å—å²¸ç¾æ™¯ã€‚", nav: "Digub Cave"},
                    {time: "Night", title: "Fermhin Forest Camp", type: "stay", desc: "å‰å¾€ Dixam é«˜åŸï¼Œåœ¨ä¸–ç•Œæœ€å¤§é¾è¡€æ¨¹æ£®æ—ä¸­éœ²ç‡Ÿã€‚", nav: "Fermhin Forest"}
                ]
            },
            {
                date: "2/20 (äº”)", loc: "Socotra", lat: 12.5, lon: 53.9,
                items: [
                    {time: "AM", title: "é¾è¡€æ¨¹æ£®æ—æ—¥å‡º", type: "activity", desc: "æ¢ç´¢ç‰¹æœ‰ç¨®å‹•æ¤ç‰©ï¼Œäº«å—é­”å¹»æ™‚åˆ»ã€‚"},
                    {time: "PM", title: "æ‹œè¨ª Bedouin æ‘è½", type: "activity", desc: "é«”é©—ç•¶åœ°ç”Ÿæ´»ï¼Œåƒè§€é¾è¡€æ¨¹è‹—åœƒ (ä¿è‚²å€)ã€‚"},
                    {time: "Night", title: "Fermhin Forest Camp", type: "stay", desc: "ç¹¼çºŒåœ¨é¾è¡€æ¨¹æ£®æ—ä¸­éœ²ç‡Ÿã€‚"}
                ]
            },
            {
                date: "2/21 (å…­)", loc: "Socotra", lat: 12.6, lon: 53.5,
                items: [
                    {time: "Day", title: "Detwah Lagoon", type: "activity", desc: "å¿…è¨ªè—è‰²æ½Ÿæ¹–ï¼ç™½æ²™èˆ‡è—æ°´çš„æ¥µè‡´å°æ¯”ã€‚", nav: "Detwah Lagoon"},
                    {time: "Sunset", title: "æ½Ÿæ¹–å±±é ‚æ—¥è½", type: "activity", desc: "çˆ¬ä¸Šå±±ä¸˜å°‹æ‰¾å­¤ç¨ç“¶å­æ¨¹ï¼Œä¿¯ç°å…¨æ™¯ã€‚"},
                    {time: "Night", title: "Detwah Lagoon Camp", type: "stay", desc: "æ½Ÿæ¹–æ—å°ˆå±¬ç‡Ÿåœ°ã€‚"}
                ]
            },
            {
                date: "2/22 (æ—¥)", loc: "Socotra", lat: 12.6, lon: 53.5,
                items: [
                    {time: "AM", title: "Shoab Golden Beach", type: "activity", desc: "æ­èˆ¹å‰å¾€é»ƒé‡‘æµ·ç˜ï¼Œå°‹æ‰¾è·³èºçš„æµ·è±š (Spinner Dolphins)ã€‚", nav: "Shoab Beach"},
                    {time: "Relax", title: "æµ·ç˜æ™‚å…‰", type: "activity", desc: "æ¸¸æ³³ã€æ”¾é¬†ã€‚ä¸‹åˆåƒè§€ Qalansiyah å°é®ã€‚", nav: "Qalansiyah"},
                    {time: "Night", title: "Detwah Lagoon Camp", type: "stay", desc: "æœ€å¾Œä¸€æ™šéœ²ç‡Ÿã€‚"}
                ]
            },
            {
                date: "2/23 (ä¸€)", loc: "Dubai", lat: 25.2, lon: 55.27,
                items: [
                    {time: "AM", title: "å‘Šåˆ¥ç´¢ç§‘ç‰¹æ‹‰", type: "activity", desc: "é€”ç¶“äºŒæˆ°ä¿„ç¾…æ–¯å¦å…‹éºè·¡æ‹ç…§ã€‚å‰å¾€æ©Ÿå ´ã€‚", nav: "Russian Tanks Socotra"},
                    {time: "10:30", title: "SCT â†’ JED â†’ DXB", type: "transport", desc: "æ¼«é•·çš„è½‰æ©Ÿè¡Œç¨‹"},
                    {time: "20:45", title: "æŠµé”æœæ‹œ", type: "transport", desc: "æ¥æ©Ÿå‰å¾€å¸‚å€"},
                    {time: "Night", title: "Check-in", type: "stay", desc: "Grande Signature Apartments", nav: "Grande Signature Apartments Dubai"}
                ]
            },
            {
                date: "2/24 (äºŒ)", loc: "Abu Dhabi", lat: 24.45, lon: 54.37,
                items: [
                    {time: "AM", title: "å¤§æ¸…çœŸå¯º", type: "activity", desc: "Sheikh Zayed Grand Mosqueã€‚æ³¨æ„æœè£ï¼", nav: "Sheikh Zayed Grand Mosque"},
                    {time: "Noon", title: "ç¾…æµ®å®®åšç‰©é¤¨", type: "activity", desc: "Louvre Abu Dhabiã€‚", nav: "Louvre Abu Dhabi"},
                    {time: "PM", title: "é¨é¦¬é«”é©—", type: "activity", desc: "ä¸‹åˆæ´»å‹•"},
                    {time: "Dinner", title: "Time Out Market", type: "food", desc: "æ™šé¤èˆ‡å“ˆé‡Œç™¼å¡”æ°´èˆç§€", nav: "Time Out Market Dubai"}
                ]
            },
            {
                date: "2/25 (ä¸‰)", loc: "Dubai", lat: 25.2, lon: 55.27,
                items: [
                    {time: "Day", title: "æœæ‹œåŸå¸‚é«”é©—", type: "activity", desc: "èˆŠåŸå€æ•£æ­¥ã€å“ˆé‡Œç™¼å¡” 124F å±•æœ›å°ã€‚", nav: "Burj Khalifa"},
                    {time: "PM", title: "æ²™æ¼ æ™šé¤", type: "food", desc: "Desert Safariã€‚é€£çµï¼šNoble Life", nav: null}
                ]
            },
            {
                date: "2/26 (å››)", loc: "Taipei", lat: 25.0, lon: 121.5,
                items: [
                    {time: "08:45", title: "EK386 èµ·é£›", type: "transport", desc: "è¿”å›ç”œèœœçš„å®¶"},
                    {time: "20:40", title: "æŠµé”å°åŒ—", type: "transport", desc: "æ—…ç¨‹çµæŸ"}
                ]
            }
        ];

        const checklistData = {
            "éš¨èº«åŒ…": ["æ‰‹æ©Ÿ", "è­·ç…§", "Visa (ç´™æœ¬ï¼‹æ‰‹æ©Ÿ)", "æ©Ÿç¥¨ / é›»å­ç¥¨", "Drone permit", "æ—…éŠä¿éšªè³‡æ–™", "ä¿¡ç”¨å¡", "ç¾é‡‘ç¾é‡‘ (æ–°éˆ”)", "å°è²» $150â€“250", "ç·Šæ€¥å‚™ç”¨ $600+", "è¡Œå‹•é›»æº", "å……é›»ç·š", "è½‰æ¥é ­ â­", "è€³æ©Ÿ", "é ¸æ• / çœ¼ç½© / è€³å¡", "è­·å”‡è† â­", "ä¿æ¿•å™´éœ§ / é¢è†œ", "éš±å½¢çœ¼é¡ï¼‹è—¥æ°´ â­", "çœ¼é¡", "è¨˜æ†¶å¡ â­", "ç­†"],
            "è¡£ç‰©": ["ä¸Šè¡£", "çŸ­è¤²", "é•·è¤²", "ç¡è¡£", "å…§è¡£è¤²", "æ³³è¡£", "å¥³ç”Ÿé•·è£™ / é•·è¤²ï¼ˆé€²æ‘è½ã€æ¸…çœŸå¯ºï¼‰"],
            "é‹å­": ["å¥è¡Œé‹", "æ¶¼é‹ / æ‹–é‹"],
            "é˜²æ›¬ï¼†æˆ¶å¤–": ["å¤ªé™½çœ¼é¡", "å¸½å­ / æ¼å¤«å¸½", "SPF50 é˜²æ›¬ï¼ˆçŠç‘šå‹å–„ï¼‰", "æ›¬å¾Œä¿®å¾© / è˜†è–ˆ", "é˜²æ›¬å¤–å¥— / UV ç½©è¡«", "æ°´æ¯è¡£ / é•·è¢–æ³³è¡£"],
            "éœ²ç‡Ÿèˆ‡ç”Ÿæ´»": ["é ­ç‡ˆ", "å¿«ä¹¾æ¯›å·¾", "æ¿•ç´™å·¾", "ä¹¾æ´—æ‰‹", "ç›¥æ´—ç”¨å“ï¼ˆæ´—é«®ç²¾ / æ²æµ´ä¹³ / ç‰™åˆ·ç‰™è†ï¼‰", "ä¿æ¿•ä¹³æ¶²", "å°é†«è—¥åŒ…", "æ°´å£º"],
            "é›»å­ / æ”å½±": ["è¡Œå‹•é›»æº x2â€“3", "å»¶é•·ç·š", "ç›¸æ©Ÿ", "ç›¸æ©Ÿé›»æ± ", "Droneï¼‹å‚™é›»", "é˜²æ°´è¢‹ / é˜²æ²™è¢‹"],
            "å…¶ä»–": ["é˜²å¡µå£ç½© / Buff", "é›¶é£Ÿ / èƒ½é‡æ£’", "ç©ºè³¼ç‰©è¢‹"]
        };

        // --- FUNCTIONS ---

        function init() {
            renderTimeline();
            renderInfo();
            renderChecklist();
        }

        // 1. Weather API
        async function fetchWeather(lat, lon, elementId) {
            try {
                const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
                const data = await res.json();
                const temp = Math.round(data.current_weather.temperature);
                const code = data.current_weather.weathercode;
                let icon = "â˜€ï¸";
                if(code > 3) icon = "â˜ï¸";
                if(code > 60) icon = "ğŸŒ§ï¸";
                document.getElementById(elementId).innerHTML = `${icon} ${temp}Â°C`;
            } catch {
                document.getElementById(elementId).innerHTML = "ğŸŒ¤ï¸";
            }
        }

        // 2. Smart Highlighter (å°éŠè·è²¬)
        function highlightText(text) {
            // å®šç¾©é—œéµå­—è¦å‰‡
            const rules = [
                { regex: /(å¿…æ‹|å¿…çœ‹|å¿…è¨ª|çµ•ç¾|æ—¥å‡º|æµ·è±š|Sunrise|Sunset)/g, class: "hl-photo" },
                { regex: /(è­·ç…§|Visa|ç¾é‡‘|ç¾é‡‘|è½‰æ¥é ­|Drone)/g, class: "hl-alert" },
                { regex: /(æ³¨æ„|æœè£|é•·è¤²|é•·è£™)/g, class: "hl-alert" },
                { regex: /(æµ®æ½›|æ¸¸æ³³|Infinity Pool)/g, class: "hl-basic" }
            ];
            
            let newText = text;
            rules.forEach(rule => {
                newText = newText.replace(rule.regex, (match) => `<span class="${rule.class}">${match}</span>`);
            });
            return newText;
        }

        // 3. Render Timeline
        function renderTimeline() {
            const container = document.getElementById('timeline-container');
            let html = '';

            itinerary.forEach((day, idx) => {
                const weatherId = `w-${idx}`;
                // éåŒæ­¥æŠ“å–å¤©æ°£
                fetchWeather(day.lat, day.lon, weatherId);

                let itemsHtml = day.items.map(item => {
                    const navBtn = item.nav 
                        ? `<a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.nav)}" target="_blank" class="btn-map">å°èˆª</a>` 
                        : '';
                    
                    return `
                        <div class="card ${item.type}">
                            <span class="card-time">${item.time}</span>
                            <div class="card-title">${item.title}</div>
                            <div class="card-desc">${highlightText(item.desc)}</div>
                            ${navBtn}
                        </div>
                    `;
                }).join('');

                html += `
                    <div>
                        <div class="date-header">
                            <span class="date-title">${day.date}</span>
                            <span class="weather-badge" id="${weatherId}">Loading...</span>
                        </div>
                        ${itemsHtml}
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        // 4. Render Info (Flights & Hotels)
        function renderInfo() {
            // Flights
            const flightsHtml = flights.map(f => `
                <div class="flight-row">
                    <div class="f-date">${f.date}</div>
                    <div>
                        <div class="f-route">${f.route}</div>
                        <span class="f-detail">${f.code} â€¢ Term: ${f.term}</span>
                    </div>
                    <div class="f-time">${f.time}</div>
                </div>
            `).join('');
            document.getElementById('flights-list').innerHTML = flightsHtml;

            // Hotels
            const hotelsHtml = hotels.map(h => `
                <div class="card stay">
                    <div class="card-title">${h.name}</div>
                    <div class="card-desc">${h.addr}<br><span style="color:#999; font-size:12px;">${h.desc}</span></div>
                    <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(h.name + " " + h.addr)}" target="_blank" class="btn-map">å°èˆª</a>
                </div>
            `).join('');
            document.getElementById('hotels-list').innerHTML = hotelsHtml;
        }

        // 5. Render Checklist
        function renderChecklist() {
            const container = document.getElementById('checklist-container');
            let html = '';
            
            // è®€å– LocalStorage (è¨˜æ†¶åŠŸèƒ½)
            const savedState = JSON.parse(localStorage.getItem('judyTripChecklist')) || {};

            for (const [category, items] of Object.entries(checklistData)) {
                html += `<div class="check-group"><div class="check-category">${category}</div>`;
                items.forEach(item => {
                    // ç§»é™¤å¯èƒ½çš„æ–¹æ¡†ç¬¦è™Ÿ (é›–ç„¶å¾Œç«¯å·²è™•ç†ï¼Œå‰ç«¯å†ä¿éšªä¸€æ¬¡)
                    const cleanItem = item.replace(/â˜/g, '').trim();
                    const isChecked = savedState[cleanItem] ? 'checked' : '';
                    
                    html += `
                        <div class="check-item ${isChecked}" onclick="toggleCheck(this, '${cleanItem}')">
                            <div class="checkbox"></div>
                            <span>${highlightText(cleanItem)}</span>
                        </div>
                    `;
                });
                html += `</div>`;
            }
            container.innerHTML = html;
        }

        function toggleCheck(el, item) {
            el.classList.toggle('checked');
            const savedState = JSON.parse(localStorage.getItem('judyTripChecklist')) || {};
            
            if (el.classList.contains('checked')) {
                savedState[item] = true;
            } else {
                delete savedState[item];
            }
            // å­˜å…¥ LocalStorage
            localStorage.setItem('judyTripChecklist', JSON.stringify(savedState));
        }

        // Tab Switcher
        function switchTab(tabId, btn) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('tab-' + tabId).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            btn.classList.add('active');
            window.scrollTo(0,0);
        }

        // Start
        init();
    </script>
</body>
</html>
