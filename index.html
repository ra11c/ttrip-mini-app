<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ëä±Â§©Judy ÔΩúTravel Guide</title>
    <style>
        :root {
            /* ÈÖçËâ≤ÔºöÊó•ÂºèÊ•µÁ∞° x Ê≤ôÊº†È¢®ÊÉÖ */
            --bg-color: #F8F8F6;
            --card-bg: #FFFFFF;
            --text-main: #3E3E3E;
            --text-light: #949494;
            --accent-sand: #C5A065;
            --accent-pink: #D89F9F;
            --accent-blue: #7EA6B8;
            --accent-dark: #2C2C2C; /* Áî®Êñº Next Up Âç°Áâá */
            --border-radius: 14px;
            --shadow: 0 4px 16px rgba(0,0,0,0.04);
            --nav-height: 80px;
            --font-stack: -apple-system, BlinkMacSystemFont, "PingFang TC", "Microsoft JhengHei", sans-serif;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font-stack);
            margin: 0;
            padding: 0;
            padding-bottom: var(--nav-height);
            line-height: 1.6;
        }

        /* HEADER */
        header {
            padding: 40px 24px 15px 24px;
            background: var(--bg-color);
            position: sticky;
            top: 0;
            z-index: 50;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }
        h1 { margin: 0; font-size: 20px; font-weight: 700; color: var(--text-main); }
        .subtitle { font-size: 11px; color: var(--accent-sand); letter-spacing: 2px; text-transform: uppercase; font-weight: 600; }
        
        /* NEXT UP CARD (DASHBOARD) */
        .hero-card {
            background: var(--accent-dark);
            color: #FFF;
            margin: 0 20px 20px 20px;
            padding: 20px;
            border-radius: 18px;
            box-shadow: 0 8px 20px rgba(44, 44, 44, 0.2);
            position: relative;
            overflow: hidden;
            animation: slideDown 0.5s ease;
        }
        .hero-label { font-size: 10px; text-transform: uppercase; letter-spacing: 1.5px; opacity: 0.7; margin-bottom: 5px; }
        .hero-title { font-size: 18px; font-weight: 700; margin-bottom: 8px; line-height: 1.3; }
        .hero-time { font-size: 24px; font-weight: 300; font-family: monospace; color: var(--accent-sand); }
        .hero-countdown { font-size: 12px; opacity: 0.8; margin-top: 5px; }
        
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* PROGRESS BAR */
        .progress-container {
            position: sticky;
            top: 0;
            background: var(--bg-color);
            padding: 10px 20px;
            z-index: 40;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .progress-info { display: flex; justify-content: space-between; font-size: 12px; color: var(--text-light); margin-bottom: 5px; }
        .progress-bg { width: 100%; height: 8px; background: #E0E0E0; border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--accent-pink); width: 0%; transition: width 0.3s ease; border-radius: 4px; }

        /* SECTIONS */
        .section { display: none; padding: 10px 20px; animation: fadeIn 0.3s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* TIMELINE */
        .date-header {
            margin: 25px 0 10px 4px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .date-title { font-size: 17px; font-weight: 700; color: var(--text-main); }
        .weather-badge {
            font-size: 12px; color: var(--text-light);
            background: #EAEAEA; padding: 2px 10px; border-radius: 20px;
            display: flex; align-items: center; gap: 4px;
        }

        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 16px;
            margin-bottom: 14px;
            box-shadow: var(--shadow);
            position: relative;
            border-left: 3px solid #DDD;
        }
        .card.transport { border-left-color: #A0A0A0; }
        .card.stay { border-left-color: var(--accent-sand); }
        .card.food { border-left-color: var(--accent-pink); }
        .card.activity { border-left-color: var(--accent-blue); }

        .card-time { font-size: 12px; color: var(--accent-sand); font-weight: 700; font-family: monospace; display: block; margin-bottom: 6px; }
        .card-title { font-size: 16px; font-weight: 700; margin-bottom: 8px; }
        .card-desc { font-size: 14px; color: #666; margin-bottom: 10px; white-space: pre-line; }

        /* MAP BUTTON */
        .btn-map {
            display: inline-flex; align-items: center;
            background: #F2F2F2; color: var(--text-main);
            padding: 6px 12px; border-radius: 8px;
            font-size: 12px; font-weight: 600; text-decoration: none;
        }

        /* HIGHLIGHTS */
        .hl-basic { background: #FFF4E5; color: #D35400; padding: 0 4px; border-radius: 4px; }
        .hl-photo { background: #E8F4F8; color: #2980B9; padding: 0 4px; border-radius: 4px; }
        .hl-alert { background: #FDEBD0; color: #C0392B; padding: 0 4px; border-radius: 4px; font-weight: bold; }

        /* CHECKLIST */
        .check-group { margin-bottom: 25px; }
        .check-category { font-size: 14px; font-weight: 700; color: var(--accent-sand); margin-bottom: 10px; }
        .check-item {
            display: flex; align-items: center; padding: 12px 0;
            border-bottom: 1px solid #F4F4F4; cursor: pointer;
        }
        .checkbox {
            width: 20px; height: 20px; border: 1.5px solid #CCC; border-radius: 50%;
            margin-right: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;
        }
        .check-item.checked .checkbox { background: var(--accent-pink); border-color: var(--accent-pink); }
        .check-item.checked .checkbox::after { content: '‚úì'; color: white; font-size: 12px; }
        .check-item.checked span { color: #CCC; text-decoration: line-through; }

        /* BOTTOM NAV */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(255, 255, 255, 0.96);
            border-top: 1px solid #EEE; display: flex; justify-content: space-around;
            padding: 10px 0 25px 0; z-index: 100; backdrop-filter: blur(10px);
        }
        .nav-item { text-align: center; font-size: 10px; color: #C0C0C0; flex: 1; cursor: pointer; }
        .nav-item.active { color: var(--text-main); font-weight: 600; }
        .nav-icon { font-size: 22px; display: block; margin-bottom: 4px; }

        /* INFO TAB STYLES */
        .info-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #eee; font-size: 14px; }
    </style>
</head>
<body>

    <header>
        <div>
            <h1>Ëä±Â§©Judy</h1>
            <span class="subtitle">Quick Travel Guide</span>
        </div>
        <div style="font-size: 12px; font-weight: bold; background: #EEE; padding: 4px 10px; border-radius: 20px;">11 Days</div>
    </header>

    <div id="tab-timeline" class="section active">
        <div id="hero-card" class="hero-card">
            <div class="hero-label">NEXT UP</div>
            <div class="hero-title" id="next-title">ÊóÖÁ®ãÂç≥Â∞áÈñãÂßã...</div>
            <div class="hero-time" id="next-time">--:--</div>
            <div class="hero-countdown" id="next-countdown">Ê∫ñÂÇôÂá∫ÁôºÔºÅ</div>
        </div>

        <div id="timeline-container"></div>
    </div>

    <div id="tab-info" class="section">
        <h3 style="color:var(--text-light); font-size:14px; margin-bottom:10px;">FLIGHTS</h3>
        <div class="card" id="flights-container"></div>
        
        <h3 style="color:var(--text-light); font-size:14px; margin:20px 0 10px 0;">HOTELS</h3>
        <div id="hotels-container"></div>

        <h3 style="color:var(--text-light); font-size:14px; margin:20px 0 10px 0;">MAP</h3>
        <div class="card">
            <div class="card-title">ÊôØÈªûÂú∞Âúñ</div>
            <div class="card-desc">ÈªûÊìä‰∏ãÊñπÊåâÈàïÈñãÂïü‰∏ªË¶ÅÊôØÈªûÂ∞éËà™</div>
            <a href="https://www.google.com/maps/search/?api=1&query=Socotra+Island" target="_blank" class="btn-map" style="width:100%; justify-content:center;">ÈñãÂïü Google Maps</a>
        </div>
    </div>

    <div id="tab-checklist" class="section" style="padding-top:0;">
        <div class="progress-container">
            <div class="progress-info">
                <span>ÊâìÂåÖÈÄ≤Â∫¶</span>
                <span id="progress-text">0%</span>
            </div>
            <div class="progress-bg">
                <div class="progress-fill" id="progress-bar"></div>
            </div>
        </div>
        <div id="checklist-container" style="margin-top: 20px;"></div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('timeline', this)">
            <span class="nav-icon">üß≠</span>Ë°åÁ®ã
        </div>
        <div class="nav-item" onclick="switchTab('info', this)">
            <span class="nav-icon">üé´</span>Ë≥áË®ä
        </div>
        <div class="nav-item" onclick="switchTab('checklist', this)">
            <span class="nav-icon">üéí</span>ÊâìÂåÖ
        </div>
    </nav>

    <script>
        // --- 1. DATA CONFIG ---
        const YEAR = 2026; // ÊåáÂÆöÂπ¥‰ªΩ
        
        const itinerary = [
            {
                date: "2/15", displayDate: "2/15 (Êó•)", loc: "Taipei", lat: 25.07, lon: 121.23,
                items: [
                    {time: "23:00", title: "EK367 Ëµ∑È£õ", type: "transport", desc: "ÂâçÂæÄÊùúÊãú | È£õË°åÊôÇÈñìÁ¥Ñ 9hr 50m", nav: "Taoyuan Airport"}
                ]
            },
            {
                date: "2/16", displayDate: "2/16 (‰∏Ä)", loc: "Jeddah", lat: 21.54, lon: 39.17,
                items: [
                    {time: "04:50", title: "ÊäµÈÅîÊùúÊãú (ËΩâÊ©ü)", type: "transport", desc: "Á≠âÂæÖËΩâÊ©üÂâçÂæÄÂêâÈÅî"},
                    {time: "12:20", title: "È£õÂæÄÂêâÈÅî (XY502)", type: "transport", desc: "ÊäµÈÅîÂæåÂÖ•Â¢ÉÊ≤ôÁÉèÂú∞"},
                    {time: "16:00", title: "Check-in", type: "stay", desc: "Best Western Plus Jeddah Hotel", nav: "Best Western Plus Jeddah Hotel Madinah Road"},
                    {time: "19:00", title: "Waterfront Dinner", type: "food", desc: "ÂêâÈÅîÊø±Êµ∑Ë∑ØÊï£Ê≠•ËàáÊôöÈ§ê", nav: "Jeddah Corniche"}
                ]
            },
            {
                date: "2/17", displayDate: "2/17 (‰∫å)", loc: "Socotra", lat: 12.6, lon: 54.0,
                items: [
                    {time: "11:00", title: "È£õÂæÄÁ¥¢ÁßëÁâπÊãâ (IY525)", type: "transport", desc: "JED -> SCT"},
                    {time: "14:30", title: "Majestic White Dunes", type: "activity", desc: "ÊäµÈÅîÔºÅÂâçÂæÄÊù±ÈÉ®„ÄÇÈÄîÁ∂ìÈ¶ñÈÉΩ Hadibo„ÄÇ"},
                    {time: "19:00", title: "Erisel Beach Èú≤Ááü", type: "stay", desc: "Á¨¨‰∏ÄÊôöÊµ∑ÁÅòÁßÅ‰∫∫Â∏≥ÁØ∑Ôºå‰∫´ÂèóÊòüÁ©∫„ÄÇ", nav: "Arher Beach"}
                ]
            },
            {
                date: "2/18", displayDate: "2/18 (‰∏â)", loc: "Socotra", lat: 12.6, lon: 54.0,
                items: [
                    {time: "05:30", title: "Arher Sand Dunes Êó•Âá∫", type: "activity", desc: "ÂøÖÁúãÊó•Âá∫ÔºÅÊªëÊ≤ô„ÄÇÁïôÊÑèÊµ∑Ë±ö (Spinner Dolphins)„ÄÇ", nav: "Arher Beach"},
                    {time: "10:00", title: "Dihamri Êµ∑Ê¥ã‰øùË≠∑ÂçÄ", type: "activity", desc: "ÊµÆÊΩõÁÜ±Èªû (Snorkeling)ÔºåË±êÂØåÁèäÁëöËàáÈ≠öÁæ§„ÄÇ", nav: "Dihamri Marine Protected Area"},
                    {time: "14:00", title: "Homhil ÁÑ°ÈÇäÈöõÊ≥≥Ê±†", type: "activity", desc: "ÁµïÁæéÂ§©ÁÑ∂Ê≥≥Ê±† (Infinity Pool)ÔºåÁú∫ÊúõÂåóÂ≤∏„ÄÇ", nav: "Homhil Protected Area"},
                    {time: "19:00", title: "Erisel Beach Èú≤Ááü", type: "stay", desc: "ËøîÂõûÊù±Â≤∏ÁáüÂú∞ÈÅéÂ§ú„ÄÇ"}
                ]
            },
            {
                date: "2/19", displayDate: "2/19 (Âõõ)", loc: "Socotra", lat: 12.5, lon: 53.9,
                items: [
                    {time: "09:00", title: "Kaleesan White Canyon", type: "activity", desc: "ÁôΩËâ≤Â≥ΩË∞∑ËàáËîöËóçÊ±†Ê∞¥ÔºåÈÅ©ÂêàÊ∏∏Ê≥≥Ë∑≥Ê∞¥„ÄÇ", nav: "Wadi Kalisan"},
                    {time: "15:00", title: "Zahek Desert & Camel", type: "activity", desc: "Ê≤ôÊº†Êº´Ê≠•ËàáÈ®éÈß±ÈßùÔºåÈ´îÈ©óÈòøÊãâ‰ºØ‰πãÂ§ú„ÄÇ", nav: "Zahek Dunes"},
                    {time: "17:00", title: "Digub Cave", type: "activity", desc: "Â∑®Â§ßÊ¥ûÁ©¥Ôºå‰øØÁû∞ÂçóÂ≤∏ÁæéÊôØ„ÄÇ", nav: "Digub Cave"},
                    {time: "19:00", title: "Fermhin Forest Camp", type: "stay", desc: "Âú®‰∏ñÁïåÊúÄÂ§ßÈæçË°ÄÊ®πÊ£ÆÊûó‰∏≠Èú≤Ááü„ÄÇ", nav: "Fermhin Forest"}
                ]
            },
            {
                date: "2/20", displayDate: "2/20 (‰∫î)", loc: "Socotra", lat: 12.5, lon: 53.9,
                items: [
                    {time: "06:00", title: "ÈæçË°ÄÊ®πÊ£ÆÊûóÊó•Âá∫", type: "activity", desc: "Êé¢Á¥¢ÁâπÊúâÁ®ÆÂãïÊ§çÁâ©Ôºå‰∫´ÂèóÈ≠îÂπªÊôÇÂàª„ÄÇ"},
                    {time: "14:00", title: "Bedouin ÊùëËêΩÊãúË®™", type: "activity", desc: "È´îÈ©óÁï∂Âú∞ÁîüÊ¥ªÔºåÂèÉËßÄÈæçË°ÄÊ®πËãóÂúÉ„ÄÇ"},
                    {time: "19:00", title: "Fermhin Forest Camp", type: "stay", desc: "ÁπºÁ∫åÂú®ÈæçË°ÄÊ®πÊ£ÆÊûó‰∏≠Èú≤Ááü„ÄÇ"}
                ]
            },
            {
                date: "2/21", displayDate: "2/21 (ÂÖ≠)", loc: "Socotra", lat: 12.6, lon: 53.5,
                items: [
                    {time: "10:00", title: "Detwah Lagoon", type: "activity", desc: "ÂøÖË®™ËóçËâ≤ÊΩüÊπñÔºÅÁôΩÊ≤ôËàáËóçÊ∞¥„ÄÇ", nav: "Detwah Lagoon"},
                    {time: "17:30", title: "ÊΩüÊπñÂ±±È†ÇÊó•ËêΩ", type: "activity", desc: "Áà¨‰∏äÂ±±‰∏òÂ∞ãÊâæÂ≠§Áç®Áì∂Â≠êÊ®π„ÄÇ"},
                    {time: "19:00", title: "Detwah Lagoon Camp", type: "stay", desc: "ÊΩüÊπñÊóÅÂ∞àÂ±¨ÁáüÂú∞„ÄÇ"}
                ]
            },
            {
                date: "2/22", displayDate: "2/22 (Êó•)", loc: "Socotra", lat: 12.6, lon: 53.5,
                items: [
                    {time: "09:00", title: "Shoab Golden Beach", type: "activity", desc: "Êê≠ËàπÂâçÂæÄÔºåÂ∞ãÊâæÊµ∑Ë±ö (Spinner Dolphins)„ÄÇ", nav: "Shoab Beach"},
                    {time: "14:00", title: "Qalansiyah Â∞èÈéÆ", type: "activity", desc: "ÂèÉËßÄÂ≥∂‰∏äÁ¨¨‰∫åÂ§ßÂüéÈéÆ„ÄÇ", nav: "Qalansiyah"},
                    {time: "19:00", title: "Detwah Lagoon Camp", type: "stay", desc: "ÊúÄÂæå‰∏ÄÊôöÈú≤Ááü„ÄÇ"}
                ]
            },
            {
                date: "2/23", displayDate: "2/23 (‰∏Ä)", loc: "Dubai", lat: 25.2, lon: 55.27,
                items: [
                    {time: "08:00", title: "ÂëäÂà•Á¥¢ÁßëÁâπÊãâ", type: "activity", desc: "ÂâçÂæÄÊ©üÂ†¥„ÄÇ"},
                    {time: "10:30", title: "SCT ‚Üí JED ‚Üí DXB", type: "transport", desc: "Êº´Èï∑ÁöÑËΩâÊ©üË°åÁ®ã"},
                    {time: "20:45", title: "ÊäµÈÅîÊùúÊãú", type: "transport", desc: "Êé•Ê©üÂâçÂæÄÂ∏ÇÂçÄ"},
                    {time: "22:00", title: "Check-in", type: "stay", desc: "Grande Signature Apartments", nav: "Grande Signature Apartments Dubai"}
                ]
            },
            {
                date: "2/24", displayDate: "2/24 (‰∫å)", loc: "Abu Dhabi", lat: 24.45, lon: 54.37,
                items: [
                    {time: "09:00", title: "Â§ßÊ∏ÖÁúüÂØ∫", type: "activity", desc: "Sheikh Zayed Grand Mosque„ÄÇÊ≥®ÊÑèÊúçË£ùÔºÅ", nav: "Sheikh Zayed Grand Mosque"},
                    {time: "12:00", title: "ÁæÖÊµÆÂÆÆÂçöÁâ©È§®", type: "activity", desc: "Louvre Abu Dhabi„ÄÇ", nav: "Louvre Abu Dhabi"},
                    {time: "18:00", title: "Time Out Market", type: "food", desc: "ÊôöÈ§êËàáÂìàÈáåÁôºÂ°îÊ∞¥ËàûÁßÄ", nav: "Time Out Market Dubai"}
                ]
            },
            {
                date: "2/25", displayDate: "2/25 (‰∏â)", loc: "Dubai", lat: 25.2, lon: 55.27,
                items: [
                    {time: "10:00", title: "ËàäÂüéÂçÄÊï£Ê≠•", type: "activity", desc: "ÈªÉÈáëÂ∏ÇÈõÜ„ÄÅÈ¶ôÊñôÂ∏ÇÈõÜ„ÄÇ", nav: "Al Fahidi"},
                    {time: "14:00", title: "ÂìàÈáåÁôºÂ°î 124F", type: "activity", desc: "‰∏ñÁïåÊúÄÈ´òÊ®ìÂ±ïÊúõÂè∞„ÄÇ", nav: "Burj Khalifa"},
                    {time: "17:00", title: "Ê≤ôÊº†ÊôöÈ§ê Safari", type: "food", desc: "Desert Safari„ÄÇ", nav: null}
                ]
            },
            {
                date: "2/26", displayDate: "2/26 (Âõõ)", loc: "Taipei", lat: 25.0, lon: 121.5,
                items: [
                    {time: "08:45", title: "EK386 Ëµ∑È£õ", type: "transport", desc: "ËøîÂõûÁîúËúúÁöÑÂÆ∂"}
                ]
            }
        ];

        const checklistData = {
            "Èö®Ë∫´ÂåÖ": ["ÊâãÊ©ü", "Ë≠∑ÁÖß", "Visa", "Ê©üÁ•®", "Drone permit", "‰øùÈö™Ë≥áÊñô", "‰ø°Áî®Âç°", "ÁæéÈáëÁèæÈáë", "Ë°åÂãïÈõªÊ∫ê", "ÂÖÖÈõªÁ∑ö", "ËΩâÊé•È†≠", "ËÄ≥Ê©ü", "È†∏Êûï/ÁúºÁΩ©"],
            "Ë°£Áâ©": ["‰∏äË°£", "Áü≠Ë§≤", "Èï∑Ë§≤", "Áù°Ë°£", "ÂÖßË°£Ë§≤", "Ê≥≥Ë°£", "Èï∑Ë£ô/Èï∑Ë§≤ (Ê∏ÖÁúüÂØ∫)"],
            "ÈûãÂ≠ê": ["ÂÅ•Ë°åÈûã", "Ê∂ºÈûã/ÊãñÈûã"],
            "Èò≤Êõ¨ & Êà∂Â§ñ": ["Â§™ÈôΩÁúºÈè°", "Â∏ΩÂ≠ê", "Èò≤Êõ¨‰π≥", "Êõ¨Âæå‰øÆÂæ©", "Èò≤Êõ¨Â§ñÂ•ó", "Ê∞¥ÊØçË°£"],
            "Èú≤Ááü & ÁîüÊ¥ª": ["È†≠Ááà", "Âø´‰πæÊØõÂ∑æ", "ÊøïÁ¥ôÂ∑æ", "‰πæÊ¥óÊâã", "Áõ•Ê¥óÁî®ÂìÅ", "‰øùÊøï‰π≥Ê∂≤", "Ê∞¥Â£∫"],
            "ÈõªÂ≠ê": ["Áõ∏Ê©ü+ÈõªÊ±†", "Drone+ÂÇôÈõª", "Èò≤Ê∞¥Ë¢ã"]
        };

        const flights = [
            {date: "2/15", code: "EK367", route: "TPE ‚Üí DXB", time: "23:00", term: "T3"},
            {date: "2/16", code: "XY502", route: "DXB ‚Üí JED", time: "12:20", term: "T1"},
            {date: "2/17", code: "IY525", route: "JED ‚Üí SCT", time: "11:00", term: "-"},
            {date: "2/23", code: "IY526", route: "SCT ‚Üí JED", time: "10:30", term: "-"},
            {date: "2/23", code: "XY505", route: "JED ‚Üí DXB", time: "17:00", term: "-"},
            {date: "2/26", code: "EK386", route: "DXB ‚Üí TPE", time: "08:45", term: "T3"}
        ];

        const hotels = [
            {name: "Best Western Plus Jeddah", addr: "Madinah Road"},
            {name: "Socotra Campsites", addr: "Private Tents"},
            {name: "Grande Signature Apartments", addr: "Dubai Downtown"}
        ];

        // --- 2. LOGIC: NEXT UP (DASHBOARD) ---
        function updateNextUp() {
            const now = new Date();
            let nextEvent = null;
            let minDiff = Infinity;

            // ÈÅçÊ≠∑ÊâÄÊúâË°åÁ®ãÊâæÂá∫„ÄåÊúÄËøëÁöÑ‰∏ÄÂÄãÊú™‰æÜ‰∫ã‰ª∂„Äç
            itinerary.forEach(day => {
                day.items.forEach(item => {
                    // Ëß£ÊûêÊôÇÈñìÂ≠ó‰∏≤ (e.g. "2/15" + "23:00") -> Date Object
                    // Ê≥®ÊÑèÔºöÈÄôË£°Áõ¥Êé•‰ΩøÁî®ÊâãÊ©üÊôÇÈñìÂÅöÊØîÂ∞çÔºåÈÅ©ÂêàÊóÖË°åÁï∂‰∏ã‰ΩøÁî®
                    const dateStr = `${YEAR}/${day.date} ${item.time}`;
                    const eventDate = new Date(dateStr);
                    
                    const diff = eventDate - now;

                    // ÊâæÂá∫Á¨¨‰∏ÄÂÄãÈÇÑÊ≤íÁôºÁîü (diff > 0) ‰∏îÊúÄËøëÁöÑ‰∫ã‰ª∂
                    if (diff > 0 && diff < minDiff) {
                        minDiff = diff;
                        nextEvent = { ...item, eventDate: eventDate, dateDisplay: day.date };
                    }
                });
            });

            if (nextEvent) {
                document.getElementById('next-title').innerText = nextEvent.title;
                document.getElementById('next-time').innerText = nextEvent.time;
                
                // ÂÄíÊï∏Ë®àÊôÇÊ†ºÂºèÂåñ
                const hours = Math.floor(minDiff / (1000 * 60 * 60));
                const mins = Math.floor((minDiff % (1000 * 60 * 60)) / (1000 * 60));
                
                if (hours > 24) {
                    const days = Math.floor(hours / 24);
                    document.getElementById('next-countdown').innerText = `ÈÇÑÊúâ ${days} Â§© ${hours % 24} Â∞èÊôÇ`;
                } else if (hours > 0) {
                    document.getElementById('next-countdown').innerText = `ÈÇÑÊúâ ${hours} Â∞èÊôÇ ${mins} ÂàÜÈêò`;
                } else {
                    document.getElementById('next-countdown').innerText = `Âç≥Â∞áÈñãÂßãÔºÅÈÇÑÊúâ ${mins} ÂàÜÈêò`;
                    document.getElementById('next-countdown').style.color = "#FFD700";
                }
            } else {
                document.getElementById('next-title').innerText = "ÊóÖÁ®ãÂ∑≤ÁµêÊùü";
                document.getElementById('next-time').innerText = "";
                document.getElementById('next-countdown').innerText = "ÊúüÂæÖ‰∏ã‰∏ÄÊ¨°ÂÜíÈö™ÔºÅ";
            }
        }

        // --- 3. LOGIC: OFFLINE WEATHER ---
        async function fetchWeather(lat, lon, elementId) {
            const cacheKey = `weather_${lat}_${lon}`;
            const cachedData = localStorage.getItem(cacheKey);

            // 1. Â¶ÇÊûúÊúâÂø´ÂèñÔºåÂÖàÈ°ØÁ§∫Âø´Âèñ (Èõ¢Á∑öÂÑ™ÂÖà)
            if (cachedData) {
                const data = JSON.parse(cachedData);
                renderWeather(elementId, data.temp, data.code, true); // true indicates cached
            }

            // 2. ÂòóË©¶ÊäìÂèñÊñ∞Ë≥áÊñô
            try {
                const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
                const data = await res.json();
                const temp = Math.round(data.current_weather.temperature);
                const code = data.current_weather.weathercode;

                // Êõ¥Êñ∞ UI
                renderWeather(elementId, temp, code, false);

                // Êõ¥Êñ∞Âø´Âèñ
                localStorage.setItem(cacheKey, JSON.stringify({ temp, code, timestamp: new Date().getTime() }));
            } catch (e) {
                console.log("Offline mode: showing cached data if available");
                if (!cachedData) {
                    document.getElementById(elementId).innerText = "No Net";
                }
            }
        }

        function renderWeather(elementId, temp, code, isCached) {
            let icon = "‚òÄÔ∏è";
            if (code > 3) icon = "‚òÅÔ∏è";
            if (code > 50) icon = "üåßÔ∏è";
            
            const el = document.getElementById(elementId);
            el.innerHTML = `${icon} ${temp}¬∞C`;
            if(isCached) {
                el.style.opacity = "0.6"; // Âø´ÂèñË≥áÊñôÁ®çÂæÆÊ∑°‰∏ÄÈªû
            } else {
                el.style.opacity = "1";
            }
        }

        // --- 4. LOGIC: HIGHLIGHT & RENDER ---
        function highlightText(text) {
            const rules = [
                { regex: /(ÂøÖÊãç|ÂøÖÁúã|ÂøÖË®™|ÁµïÁæé|Êó•Âá∫|Êµ∑Ë±ö|Sunrise|Sunset)/g, class: "hl-photo" },
                { regex: /(Ë≠∑ÁÖß|Visa|ÁèæÈáë|ÁæéÈáë|ËΩâÊé•È†≠|Drone)/g, class: "hl-alert" },
                { regex: /(Ê≥®ÊÑè|ÊúçË£ù|Èï∑Ë§≤|Èï∑Ë£ô)/g, class: "hl-alert" },
                { regex: /(ÊµÆÊΩõ|Ê∏∏Ê≥≥|Infinity Pool)/g, class: "hl-basic" }
            ];
            let newText = text;
            rules.forEach(rule => {
                newText = newText.replace(rule.regex, (match) => `<span class="${rule.class}">${match}</span>`);
            });
            return newText;
        }

        function renderTimeline() {
            const container = document.getElementById('timeline-container');
            let html = '';
            itinerary.forEach((day, idx) => {
                const weatherId = `w-${idx}`;
                fetchWeather(day.lat, day.lon, weatherId);
                let itemsHtml = day.items.map(item => {
                    const navBtn = item.nav ? `<a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.nav)}" target="_blank" class="btn-map">üìç Â∞éËà™</a>` : '';
                    return `
                        <div class="card ${item.type}">
                            <span class="card-time">${item.time}</span>
                            <div class="card-title">${item.title}</div>
                            <div class="card-desc">${highlightText(item.desc)}</div>
                            ${navBtn}
                        </div>`;
                }).join('');
                html += `<div><div class="date-header"><span class="date-title">${day.displayDate}</span><span class="weather-badge" id="${weatherId}">...</span></div>${itemsHtml}</div>`;
            });
            container.innerHTML = html;
        }

        function renderInfo() {
            document.getElementById('flights-container').innerHTML = flights.map(f => `
                <div class="info-row">
                    <span style="font-weight:bold; color:var(--accent-blue)">${f.date}</span>
                    <span>${f.route} <small>(${f.code})</small></span>
                    <span style="font-family:monospace">${f.time}</span>
                </div>`).join('');
            
            document.getElementById('hotels-container').innerHTML = hotels.map(h => `
                <div class="card stay">
                    <div class="card-title">${h.name}</div>
                    <div class="card-desc">${h.addr}</div>
                    <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(h.name + " " + h.addr)}" target="_blank" class="btn-map">üìç Â∞éËà™</a>
                </div>`).join('');
        }

        // --- 5. LOGIC: CHECKLIST PROGRESS ---
        function renderChecklist() {
            const container = document.getElementById('checklist-container');
            let html = '';
            const savedState = JSON.parse(localStorage.getItem('judyTripChecklist')) || {};
            
            let totalItems = 0;
            let checkedCount = 0;

            for (const [category, items] of Object.entries(checklistData)) {
                html += `<div class="check-group"><div class="check-category">${category}</div>`;
                items.forEach(item => {
                    totalItems++;
                    const isChecked = savedState[item] ? 'checked' : '';
                    if(isChecked) checkedCount++;
                    
                    html += `
                        <div class="check-item ${isChecked}" onclick="toggleCheck(this, '${item}')">
                            <div class="checkbox"></div>
                            <span>${highlightText(item)}</span>
                        </div>`;
                });
                html += `</div>`;
            }
            container.innerHTML = html;
            updateProgress(checkedCount, totalItems);
        }

        function toggleCheck(el, item) {
            el.classList.toggle('checked');
            const savedState = JSON.parse(localStorage.getItem('judyTripChecklist')) || {};
            if (el.classList.contains('checked')) {
                savedState[item] = true;
            } else {
                delete savedState[item];
            }
            localStorage.setItem('judyTripChecklist', JSON.stringify(savedState));
            
            // Recalculate Progress
            const total = document.querySelectorAll('.check-item').length;
            const checked = document.querySelectorAll('.check-item.checked').length;
            updateProgress(checked, total);
        }

        function updateProgress(checked, total) {
            const percent = Math.round((checked / total) * 100);
            document.getElementById('progress-bar').style.width = `${percent}%`;
            document.getElementById('progress-text').innerText = `${checked} / ${total} (${percent}%)`;
        }

        function switchTab(tabId, btn) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('tab-' + tabId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            btn.classList.add('active');
            window.scrollTo(0,0);
        }

        // INIT
        renderTimeline();
        renderInfo();
        renderChecklist();
        updateNextUp();
        setInterval(updateNextUp, 60000); // Update countdown every minute

    </script>
</body>
</html>
